{% extends 'base.html.twig' %}

{% block title %}Collection de
	{{ utilisateur.pseudo }}
{% endblock %}

{% block breadcrumb %}
	<nav aria-label="breadcrumb" class="mb-4">
		<ol class="breadcrumb">
			<li class="breadcrumb-item">
				<a href="{{ path('app_home') }}">Accueil</a>
			</li>
			<li class="breadcrumb-item">
				<a href="{{ path('app_collection_index') }}">Collections</a>
			</li>
			<li class="breadcrumb-item active" aria-current="page">{{ utilisateur.pseudo }}</li>
		</ol>
	</nav>
{% endblock %}

{% block body %}
	<div class="card shadow-sm card-full-height">
		<div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
			<h1 class="h3 mb-0">
				<i class="bi bi-collection text-primary"></i>
				Collection de
				{{ utilisateur.prenom }}
				{{ utilisateur.nom }}
			</h1>
			<a href="{{ path('app_collection_add', {'id': utilisateur.id}) }}" class="btn btn-primary">
				<i class="bi bi-plus-lg"></i>
				Ajouter un jeu
			</a>
		</div>
		<div class="card-body p-0">
			<div class="table-scrollable-area">
				<table class="table table-hover table-striped mb-0">
					<thead class="table-light">
						<tr>
							<th class="ps-4">Image</th>
							<th>Jeu</th>
							<th>Statut</th>
							<th>Date Modif Statut</th>
							<th>Prix Achat</th>
							<th>Date Achat</th>
							<th>Commentaire</th>
							<th class="text-end pe-4">Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for collect in collects %}
							<tr>
								<td class="ps-4">
									{% if collect.jeuvideo.imageUrl %}
										<img src="{{ asset(collect.jeuvideo.imageUrl) }}" alt="{{ collect.jeuvideo.titre }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
									{% else %}
										<span class="text-muted" style="font-size: 0.8rem;">Aucune</span>
									{% endif %}
								</td>
								<td class="fw-medium">
									<a href="{{ path('app_jeu_video_show', {'id': collect.jeuvideo.id}) }}" class="text-decoration-none">
										{{ collect.jeuvideo.titre }}
									</a>
								</td>
								<td>
									{% set statutClass = {
										'POSSEDE': 'bg-success',
										'SOUHAITE': 'bg-warning text-dark',
										'EN_COURS': 'bg-info text-dark',
										'TERMINE': 'bg-primary',
										'ABANDONNE': 'bg-secondary',
										'PRETE': 'bg-dark',
										'VENDU': 'bg-danger',
										'PLATINE': 'bg-warning text-dark'
									} %}
									<span class="badge {{ statutClass[collect.statut.value] ?? 'bg-secondary' }}">
										{{ collect.statut.getLabel() }}
									</span>
								</td>
								<td>{{ collect.dateModifStatut ? collect.dateModifStatut|date('d/m/Y H:i') : '-' }}</td>
								<td class="text-nowrap">{{ collect.prixAchat ? collect.prixAchat|number_format(2, ',', ' ') ~ '€' : '-' }}</td>
								<td>{{ collect.dateAchat ? collect.dateAchat|date('d/m/Y') : '-' }}</td>
								<td>{{ collect.commentaire|length > 30 ? collect.commentaire|slice(0, 30) ~ '...' : collect.commentaire }}</td>
								<td class="text-end pe-4">
									<div class="btn-group" role="group">
										<a href="{{ path('app_collection_edit', {'id': collect.id}) }}" class="btn btn-sm btn-outline-warning" title="Modifier">
											Modifier
										</a>
										<form method="post" action="{{ path('app_collection_delete', {'id': collect.id}) }}" style="display: inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce jeu de la collection ?');">
											<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ collect.id) }}">
											<button class="btn btn-sm btn-outline-danger">Supprimer</button>
										</form>
									</div>
								</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="8" class="text-center py-4 text-muted">Aucun jeu dans cette collection</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		<div class="card-footer bg-light">
			<a href="{{ path('app_collection_index') }}" class="btn btn-secondary">
				<i class="bi bi-arrow-left"></i>
				Retour à la liste des collections
			</a>
		</div>
	</div>
{% endblock %}
